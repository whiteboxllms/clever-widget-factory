# CloudFront Configuration for Image Security
# Generated: 2024-01-15
# 
# This file documents the CloudFront configuration values needed for
# the Cookie Generator Lambda function and CloudFront distribution setup.
#
# IMPORTANT: This file contains PUBLIC identifiers only (safe to commit to git).
# The private key is stored securely in AWS Secrets Manager.

# ============================================================================
# CloudFront Key Pair Configuration (Task 1.1, 1.4)
# ============================================================================

# CloudFront Key Pair ID (from AWS Console → CloudFront → Key Management)
# Format: APKAXXXXXXXXXX (starts with "APKA")
# This is a PUBLIC identifier - safe to store in environment variables
# Used in: Lambda environment variable, CloudFront signed cookies
CLOUDFRONT_KEY_PAIR_ID=REPLACE_WITH_YOUR_KEY_PAIR_ID

# ============================================================================
# AWS Secrets Manager Configuration (Task 1.3)
# ============================================================================

# Secrets Manager secret name containing the CloudFront private key
# The private key is stored securely in Secrets Manager (NOT in env vars)
# Lambda will retrieve this secret at runtime to sign cookies
CLOUDFRONT_PRIVATE_KEY_SECRET_NAME=cloudfront-private-key

# ============================================================================
# CloudFront Distribution Configuration (Task 5)
# ============================================================================

# CloudFront distribution domain name (will be set after Task 5)
# Format: d1234567890.cloudfront.net
# This is the domain that will serve images via CDN
CLOUDFRONT_DOMAIN=PENDING_TASK_5

# ============================================================================
# Cookie Configuration
# ============================================================================

# Cookie expiration time in seconds
# Default: 3600 seconds (1 hour)
# Cookies will be automatically refreshed by frontend when expiring within 5 minutes
COOKIE_EXPIRATION_SECONDS=3600

# Cookie domain (will match CloudFront domain)
# Format: .cloudfront.net (note the leading dot for subdomain matching)
COOKIE_DOMAIN=.cloudfront.net

# Cookie attributes
# These ensure cookies are secure and not accessible to JavaScript
COOKIE_SECURE=true
COOKIE_HTTP_ONLY=true
COOKIE_SAME_SITE=Strict

# ============================================================================
# AWS Region Configuration
# ============================================================================

# AWS region for Secrets Manager and Cookie Generator Lambda
# Must match the region where the secret is stored
AWS_REGION=us-west-2

# Lambda@Edge region (always us-east-1 for Lambda@Edge functions)
LAMBDA_EDGE_REGION=us-east-1

# ============================================================================
# S3 Configuration
# ============================================================================

# S3 bucket name for image storage
S3_BUCKET=cwf-dev-assets

# S3 key pattern for organization-scoped images
# Format: organizations/{org_id}/images/{uuid}.{extension}
S3_KEY_PATTERN=organizations/{org_id}/images/

# ============================================================================
# Lambda Function Names (for reference)
# ============================================================================

# Cookie Generator Lambda function name (Task 6)
COOKIE_GENERATOR_LAMBDA=cwf-image-auth

# Image Resizer Lambda@Edge function name (Task 4)
IMAGE_RESIZER_LAMBDA=cwf-image-resizer

# Presigned Upload Lambda function name (Task 8)
PRESIGNED_UPLOAD_LAMBDA=cwf-presigned-upload

# ============================================================================
# API Gateway Configuration (Task 7)
# ============================================================================

# API Gateway endpoint for cookie generation
# Format: https://0720au267k.execute-api.us-west-2.amazonaws.com/prod
API_GATEWAY_URL=https://0720au267k.execute-api.us-west-2.amazonaws.com/prod

# Cookie generation endpoint path
COOKIE_ENDPOINT_PATH=/api/images/auth

# ============================================================================
# Feature Flags (for gradual rollout)
# ============================================================================

# Enable CloudFront CDN (default: false for zero-downtime migration)
# Set to true after Phase 5 testing is complete
USE_CLOUDFRONT_CDN=false

# Enable organization-scoped S3 keys (default: false)
# Set to true after CloudFront is verified working
USE_ORG_SCOPED_KEYS=false

# ============================================================================
# Monitoring and Logging
# ============================================================================

# CloudWatch log group for Cookie Generator Lambda
LOG_GROUP_COOKIE_GENERATOR=/aws/lambda/cwf-image-auth

# CloudWatch log group for Image Resizer Lambda@Edge
LOG_GROUP_IMAGE_RESIZER=/aws/lambda/us-east-1.cwf-image-resizer

# Enable debug logging (default: false)
DEBUG_LOGGING=false

# ============================================================================
# Cost Monitoring
# ============================================================================

# Monthly cost budget alert threshold (USD)
COST_BUDGET_ALERT=15.00

# Target monthly cost (USD)
COST_TARGET=10.00

# ============================================================================
# Security Configuration
# ============================================================================

# Key rotation schedule (days)
KEY_ROTATION_DAYS=90

# Next key rotation date (update after each rotation)
NEXT_KEY_ROTATION=PENDING

# ============================================================================
# Notes
# ============================================================================

# Task Completion Status:
# [x] Task 1.1: CloudFront key pair generated
# [x] Task 1.2: Private key downloaded and verified
# [x] Task 1.3: Private key stored in Secrets Manager
# [ ] Task 1.4: Key Pair ID documented (IN PROGRESS)
# [ ] Task 1.5: Key pair verified active
# [ ] Task 5: CloudFront distribution created
# [ ] Task 6: Cookie Generator Lambda deployed

# Important Links:
# - AWS Console CloudFront: https://console.aws.amazon.com/cloudfront/
# - AWS Console Secrets Manager: https://console.aws.amazon.com/secretsmanager/
# - AWS Console Lambda: https://console.aws.amazon.com/lambda/
# - Spec Directory: .kiro/specs/cloudfront-image-security/

# Security Reminders:
# - NEVER commit the private key to git (stored in Secrets Manager only)
# - NEVER log the private key value in CloudWatch
# - NEVER store the private key in environment variables
# - Key Pair ID is PUBLIC and safe to commit
# - Rotate keys every 90 days
